/*
  ----------------------------------------------------------------------
  -- - Name          : RESTUpsertAssessmentV1_TEST 
  -- - Author        : ABT 
  -- - Description   : Test class for WS RESTUpsertAssessment
  --
  -- Maintenance History:
  --
  -- Date         Name  Version  Remarks
  -- -----------  ----  -------  ---------------------------------------
  -- 25-AUG-2016  ABT    1.0     Initial Version
  -- 16-SEP-2016  ASE    1.1     Added test methods
  -- 04-MAR-2018  AMI    1.2     Updating url from /v2.0/upsertAssessment/* to /v2.0/upsertAssessmentOld/*
  ----------------------------------------------------------------------
 **********************************************************************
*/
@isTest
public class RESTUpsertAssessmentV1_TEST {

    static User adminUser;
    static List<Account> accountList;
    static List<Assessment__c> assessmentList;
    static List<PartList__c> partList;
    static List<CrossReference__c> crossReferenceList;

    static List<MasterRules__c> masterRuleList;
    static List<DetailRule__c> detailRuleList;

    //static List<CarMapping__c> carMappingList;
    static List<CarMappings__mdt> carMappingList;
    static List<AccountRef__c> accountRefList;

    static CrossReference__c cr;


    static{
        
        //create userRole
        UserRole alphaUserRole = new UserRole(Name = 'FR - AlphaScale');
        insert alphaUserRole;

        //inserting users
        adminUser = TestFactory.createUser('adminUser');
        adminUser.UserRoleId = alphaUserRole.Id;
        insert adminUser;

        System.runAs(adminUser) {
            // Generating the account
            accountList = new List<Account>{
                TestFactory.createAccountBodyshop('BodyShop_1', 'FR'),
                TestFactory.createAccountBodyshop('BodyShop_2', 'FR')
            };

            accountList[0].ContactUser__c = adminUser.Id;
            accountList[0].ReferenceNumber__c = 'FR2763223906';//WCH 23/12/2020 C-004120
            accountList[0].isEligibleSubstitution__c = true;
            accountList[1].ContactEmail__c = 'test@test.com';
            accountList[1].ReferenceNumber__c = 'FR2763223905';//WCH 23/12/2020 C-004120
            accountList[1].isEligibleSubstitution__c = true;

            insert accountList;

            /*carMappingList = new List<CarMappings__mdt>();
            carMappingList.addAll(TestFactory.createCarMappingList('GTMOTIVE'));
            carMappingList.addAll(TestFactory.createCarMappingList('DIVA'));

            insert carMappingList;*/

            //CarMappings__mdt carMapMdt = [Select D]
            
            accountRefList = new List<AccountRef__c>{
                TestFactory.createAccountRef('2763223904', accountList[0].Id, 'GTMOTIVE'),
                TestFactory.createAccountRef('FR2763223905', accountList[1].Id, 'DIVA'),
                TestFactory.createAccountRef('FR2763223906', accountList[0].Id, 'DIVA'),
                TestFactory.createAccountRef('2763223907', '001000101001001', 'DIVA')

            };

            insert accountRefList;

            // Generating the assessments
            assessmentList = new List<Assessment__c> {
                TestFactory.createAssessment('Assessment_FR', accountList[0])
            };

            assessmentList[0].TECH_EntityCountryCode__c = 'FR';
            assessmentList[0].Manufacturer__c           = 'MERCEDES';
            assessmentList[0].EntityCode__c             = '299';
            assessmentList[0].Status__c                 = 'SUBSTITUTION';
            assessmentList[0].crashCode__c              = 0;
            assessmentList[0].PlateNumber2__c           = 'AK2804';
            assessmentList[0].ClaimReference__c         = '28062006';
            assessmentList[0].AssessmentNumber__c       = (assessmentList[0].ClaimReference__c + accountList[0].ReferenceNumber__c + assessmentList[0].PlateNumber2__c).toUpperCase();
            assessmentList[0].AssessmentID__c           = 'FR' + accountRefList[0].Name.substringAfter('-') + 'Mercedes' + assessmentList[0].AssessmentNumber__c;

            insert assessmentList;

            partList = new List<PartList__c>{
                TestFactory.createPartList(assessmentList[0]),
                TestFactory.createPartList(assessmentList[0])
            };
            insert partList;

            crossReferenceList = new List<CrossReference__c>{
                TestFactory.createCrossReference('FR', 'A12 38 261290', 'Mercedes', 20.0, true),
                TestFactory.createCrossReference('FR', '0A12 38261390', 'Renault',  40.0, true),
                TestFactory.createCrossReference('FR', '0A12 38261390', 'Renault',  50.0, true),
                TestFactory.createCrossReference('FR', 'A12 38 261190', 'Mercedes', 45.0, true),
                TestFactory.createCrossReference('FR', 'A12 38 261290', 'Mercedes', 30.0, true),
                TestFactory.createCrossReference('FR', 'A12 38 261890', 'Mercedes', 30.0, true)
            };
            crossReferenceList[0].IAMPublicPrice__c = 20.0;
            crossReferenceList[1].IAMPublicPrice__c = 40.0;
            crossReferenceList[2].IAMPublicPrice__c = 50.0;
            crossReferenceList[3].IAMPublicPrice__c = 45.0;
            crossReferenceList[4].IAMPublicPrice__c = 30.0;
            crossReferenceList[0].OEMStandardDiscount__c = 2 ;
            crossReferenceList[0].OEMStandardMargin__c = 12.2;
            crossReferenceList[0].OEMPartDescription__c = 'test';

            crossReferenceList[1].OEMStandardDiscount__c = 2;
            crossReferenceList[1].OEMStandardMargin__c = 12;
            crossReferenceList[1].OEMPartDescription__c = 'test';

            crossReferenceList[2].OEMStandardDiscount__c = 2;
            crossReferenceList[2].OEMStandardMargin__c = 12;
            crossReferenceList[2].OEMPartDescription__c = 'test';

            crossReferenceList[3].OEMStandardDiscount__c = 2;
            crossReferenceList[3].OEMStandardMargin__c = 12;
            crossReferenceList[3].OEMPartDescription__c = 'test';

            crossReferenceList[4].OEMStandardDiscount__c = 2;
            crossReferenceList[4].OEMStandardMargin__c = 12;
            crossReferenceList[4].OEMPartDescription__c = 'test';

            insert crossReferenceList; 
            List<CrossReference__c> updatedCRList = new List<CrossReference__c>();
            crossReferenceList[0].ActiveForSubstitution__c = true;
            updatedCRList.add(crossReferenceList[0]);
            crossReferenceList[1].ActiveForSubstitution__c = true;
            updatedCRList.add(crossReferenceList[1]);
            crossReferenceList[2].ActiveForSubstitution__c = true;
            updatedCRList.add(crossReferenceList[2]);
            crossReferenceList[3].ActiveForSubstitution__c = true;
            updatedCRList.add(crossReferenceList[3]);
            crossReferenceList[4].ActiveForSubstitution__c = true;
            updatedCRList.add(crossReferenceList[4]);
            update updatedCRList;

            cr = [Select IAMManufacturer__c, IAMPartNumber__c, Name from CrossReference__c where  OEMPartNumber__c = 'A12 38 261190'];


            masterRuleList = new List<MasterRules__c> {
                TestFactory.createMasterRule('FR299', 'SUBSTITUTION', 'CrossReference__c')
            };

            masterRuleList[0].FilterLogic__c = '5';
            insert masterRuleList;

            detailRuleList = new List<DetailRule__c> {
                TestFactory.createDetailRule('SUBSTITUTION', masterRuleList[0], 'Name, OEMCleanPartNumber__c, OEMPartNumber__c, OEMManufacturer__c, IAMPublicPrice__c, ActiveForSubstitution__c, IAMManufacturer__c, IAMPartClass__c, IAMPartDescription__c, IAMPartNumber__c, ASPublicPrice__c,IAMCertifyingOrganization__c, ASNetPrice__c,OEMStandardDiscount__c,OEMStandardMargin__c,OEMPartDescription__c', null, null, 'Primary Fields Needed', 'CrossReference__c', 1),
                TestFactory.createDetailRule('SUBSTITUTION', masterRuleList[0], 'OEMCleanPartNumber__c-OEMManufacturer__c', null, null, 'Key Field', 'CrossReference__c', 2),
                TestFactory.createDetailRule('SUBSTITUTION', masterRuleList[0], 'IAMPublicPrice__c', 'MIN', null, 'Criteria', 'CrossReference__c', 3),
                TestFactory.createDetailRule('SUBSTITUTION', masterRuleList[0], 'SelectedByBS__c', 'EQUALS', 'TRUE', 'Update Field', 'PartList__c', 4),
                TestFactory.createDetailRule('SUBSTITUTION', masterRuleList[0], 'ASPublicPrice__c', 'NOT_EQUALS', '0', 'Filter Condition', 'CrossReference__c', 5),
                TestFactory.createDetailRule('SUBSTITUTION', masterRuleList[0], 'Assessment__r.BodyShop__r.Type', 'NOT_EQUALS', 'Expert', 'Validation', 'PartList__c', 6)
            };
            insert detailRuleList;
        }
    }


    @isTest static void upsertAssessmentException_TEST(){
        System.runAs(adminUser) {

            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"3","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE","PartNumber":"A1238261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE","PartNumber":"A1238261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"245CZE","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223904"},"currentClaim":{"ClaimReference":"2064156","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"2","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE","PartNumber":"A1238261390","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"245CZE","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223904"},"currentClaim":{"ClaimReference":"2064157","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();

            //System.assertEquals(true, jsonResponseString.contains('ErrorMessage'));
        }
    }
 
    //@isTest static void upsertAssessmentNoSubstitute_TEST(){ 
    //  System.runAs(adminUser){
    //      String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

    //      RestRequest request         = new RestRequest();
    //      request.httpMethod          = 'POST';
    //      request.requestURI          = '/v2.0/upsertAssessment/*';
    //      request.requestBody         = Blob.valueOf(requestJSONString);

    //      RestContext.request         = request;
    //      RestContext.response        = new RestResponse();

    //      RESTUpsertAssessmentV1.upsertAssessment();

    //      String requestJSONString2   = '[{"callerSystem":"DIVA","AssessmentNumber":"2812863220ZY09MERCEDES1","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
    //      RestRequest request2        = new RestRequest();
    //      request2.httpMethod         = 'POST';
    //      request2.requestURI         = '/v2.0/upsertAssessment/*';
    //      request2.requestBody        = Blob.valueOf(requestJSONString2);

    //      RestContext.request         = request2;
    //      RestContext.response        = new RestResponse();

    //      Test.startTest();
    //          RESTUpsertAssessmentV1.upsertAssessment();
    //      Test.stopTest();

    //      Blob jsonBlob               = RestContext.response.responseBody;

    //      //System.assertNotEquals(null, jsonBlob);

    //      String jsonResponseString   =  jsonBlob.toString();

    //      System.assertEquals(false, jsonResponseString.contains('ErrorMessage'));

    //      List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
    //                                                          EntityCode__c, Manufacturer__c, VINCheck__c
    //                                                   FROM   Assessment__c
    //                                                   WHERE  AssessmentNumber__c LIKE '28128627632239063220ZY09%'];

    //      system.debug('##assessmentCreatedList upsertAssessmentNoSubstitute_TEST' +assessmentCreatedList);

    //      System.assertEquals(2, assessmentCreatedList.size());
    //  }
    //}

    

    
    @isTest static void noAccountReferenceMappingFound_TEST(){
        System.runAs(adminUser){
        
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906745"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();

            //System.assertEquals(true, jsonResponseString.contains('No Account Reference Mapping found'));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                         WHERE  AssessmentNumber__c LIKE '28128627632239063220ZY09%'];

            //System.assertEquals(0, assessmentCreatedList.size());
        }
    }

    /*@isTest static void noCarMappingFound_TEST(){
        System.runAs(adminUser)
        {
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M12Inexisting","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessment/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;


            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();
            system.debug('## jsonResponseString:'+jsonResponseString);
            //System.assertEquals(true, jsonResponseString.contains('No Car Mapping found'));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                         WHERE  AssessmentNumber__c LIKE '28128627632239063220ZY09%'];

            //System.assertEquals(0, assessmentCreatedList.size());
        }
    }*/

    

    //@isTest static void upsertAssessmentBodyOver30000_TEST(){
    //  System.runAs(adminUser){
        
    // String requestJSONString = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"2","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"5","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"6","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"7","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"8","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"9","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"9","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"2","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"5","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"6","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"7","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"8","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"9","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"2812867","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"9","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"28128678","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

    //      RestRequest request         = new RestRequest();
    //      request.httpMethod          = 'POST';
    //      request.requestURI          = '/v2.0/upsertAssessment/*';
    //      request.requestBody         = Blob.valueOf(requestJSONString);

    //      RestContext.request         = request;
    //      RestContext.response        = new RestResponse();

    //      Test.startTest();
    //          RESTUpsertAssessmentV1.upsertAssessment();
    //      Test.stopTest();

    //      Blob jsonBlob               = RestContext.response.responseBody;


    //      String jsonResponseString   =  jsonBlob.toString();
            
    //      System.assertEquals(false, jsonResponseString.contains('ErrorMessage'));

    //      List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
    //                                                          EntityCode__c, Manufacturer__c, VINCheck__c
    //                                                   FROM   Assessment__c
    //                                                   WHERE  AssessmentNumber__c LIKE '28128627632239063220ZY09%'];
 
    //      System.assertEquals(9, assessmentCreatedList.size());       
    //  }
    //}

    @isTest static void upsertAssessmentMissingFieldAssessment_TEST(){
        System.runAs(adminUser){
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","Price":58,"Manufacturer":"BOSH","InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{},"currentClaim":{"CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"ASH","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","Price":58,"Manufacturer":"BOSH","InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{},"currentClaim":{"CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{},"currentClaim":{"CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"ASH","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{},"currentClaim":{"CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"AssessmentNumber":"","BSInternalRef":"ext1","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"Parts":[{"PartNumber":"A1238261290","Manufacturer":"BOSH","InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Model":"PRIUS T4","FirstRegistrationDate":"2015-04-13","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{},"currentClaim":{"CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"AssessmentNumber":"XXXXX","BSInternalRef":"ext1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Model":"PRIUS T4","FirstRegistrationDate":"2015-04-13","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{},"currentClaim":{"CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}]},{"callerSystem":"DIVA","AssessmentNumber":"YYYYY","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0},{"callerSystem":"DIVA","AssessmentNumber":"YYYYY","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}]}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();
            //system.debug('## jsonResponseString:'+jsonResponseString);

           //System.assertEquals(true, jsonResponseString.contains('currentAsset.Brand'));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                          WHERE AssessmentNumber__c LIKE '28128627632239063220ZY09%'];
 
            //System.assertEquals(0, assessmentCreatedList.size());
        }
    }

    @isTest static void upsertAssessmentWithUpsertError_TEST(){
        System.runAs(adminUser){
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"' + accountRefList[0].Name.substringAfter('-') +'"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"' + accountRefList[0].Name.substringAfter('-') +'"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"6","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"' + accountRefList[0].Name.substringAfter('-') +'"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();

            //System.assertEquals(true, jsonResponseString.contains('Exceptions:'));
        }
    }

    //@isTest static void upsertAssessmentWithContactEmail_TEST()   {
    //  System.runAs(adminUser){
    //      String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223905"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

    //      RestRequest request         = new RestRequest();
    //      request.httpMethod          = 'POST';
    //      request.requestURI          = '/v2.0/upsertAssessment/*';
    //      request.requestBody         = Blob.valueOf(requestJSONString);

    //      RestContext.request         = request;
    //      RestContext.response        = new RestResponse();

    //      Test.startTest();
    //          RESTUpsertAssessmentV1.upsertAssessment();
    //      Test.stopTest();

    //      Blob jsonBlob               = RestContext.response.responseBody;

    //      System.assertNotEquals(null, jsonBlob);

    //      String jsonResponseString   =  jsonBlob.toString();

    //      System.assertEquals(false, jsonResponseString.contains('Exceptions:'));

    //      List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
    //                                                          EntityCode__c, Manufacturer__c, VINCheck__c
    //                                                   FROM   Assessment__c 
    //                                                    WHERE AssessmentNumber__c LIKE '28128627632239053220ZY09'];
            
    //      System.assertEquals(2, assessmentCreatedList.size());
    //  } 
    //}

    @isTest static void upsertAssessmentWithCatchError_TEST()
    {
        System.runAs(adminUser)
        {
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":"0a","Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"' + accountRefList[1].Name.substringAfter('-') +'"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();

            //System.assertEquals(true, jsonResponseString.contains('Exceptions:'));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                          WHERE AssessmentNumber__c LIKE '28128627632239063220ZY09%'];
 
            //System.assertEquals(0, assessmentCreatedList.size());
        }
    }

      @isTest static void upsertAssessmentNew_TEST()    {
        System.runAs(adminUser){
            //String requestJSONString  = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"6","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223907"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            //String requestJSONString ='[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            //String requestJSONString = '[{"callerSystem":"ALPHASCALE","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"Mercedes","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"ALPHASCALE","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"0","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"Mercedes","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            String requestJSONString ='[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"MERCEDES","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"ASH-2281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}},{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"isShoppingList":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"MERCEDES","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"ASH-281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;


            String jsonResponseString   =  jsonBlob.toString();
            //system.debug('## jsonResponseString:'+jsonResponseString);
            
            //System.assertEquals(false, jsonResponseString.contains('Exceptions:'));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                         WHERE  AssessmentNumber__c LIKE 'ASH-228128627632239063220ZY09%'];
            

            system.debug('##assessmentCreatedList upsertAssessmentUpdate_TEST' +assessmentCreatedList);

            //System.assertEquals(2, assessmentCreatedList.size()); 

        } 
    }

    
    @isTest static void upsertAssessmentUpdate_TEST(){
        System.runAs(adminUser){
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"MERCEDES","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"ASH-2281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            RESTUpsertAssessmentV1.upsertAssessment(); 

            Blob jsonBlob2          = RestContext.response.responseBody;


            String jsonResponseString2  =  jsonBlob2.toString();
            system.debug('## jsonResponseString2:'+jsonResponseString2);
            
            
            //String requestJSONString2 = '[{"callerSystem":"DIVA","AssessmentNumber":"2812863220ZY09MERCEDES1","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 2611908","PartNumber":"A12 38 2611908","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"'+pl.PartNumber__c+'","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"'+pl.Alpha_Scale_MRID__c+'"},{"PartLabel":"A12 38 261290","PartNumber":"123457895","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"ASFCS412141521"}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            String requestJSONString2 ='[{"callerSystem":"DIVA","AssessmentNumber":"ASH-228128627632239063220ZY09","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"ASCR-XXXXXX","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"MERCEDES","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"ASH-2281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            RestRequest request2        = new RestRequest();
            request2.httpMethod         = 'POST';
            request2.requestURI         = '/v2.0/upsertAssessmentOld/*';
            request2.requestBody        = Blob.valueOf(requestJSONString2);

            RestContext.request         = request2;
            RestContext.response        = new RestResponse();
            

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();              
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

           //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();
            system.debug('## jsonResponseString: '+jsonResponseString);

            //System.assertEquals(true, jsonResponseString.contains('not contain substitutes: '));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                         WHERE  AssessmentNumber__c LIKE 'ASH-228128627632239063220ZY09%'];
            

            system.debug('##assessmentCreatedList upsertAssessmentUpdate_TEST' +assessmentCreatedList);

            //System.assertEquals(2, assessmentCreatedList.size()); 
            
            list<PartList__c> plList = [Select id, Name, Alpha_Scale_MRID__c, PartNumber__c from PartList__c where isDeleted__c = true and Assessment__c =: assessmentCreatedList[0].Id];
            system.debug('## plList:'+plList);
            //System.assertEquals(4, plList.size()); 
            
        }
    }

    @isTest static void upsertAssessmentUpdateShip_TEST(){
        System.runAs(adminUser){
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"A12 38 261290","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"MERCEDES","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"ASH-2281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessmentOld/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            RESTUpsertAssessmentV1.upsertAssessment(); 

            Blob jsonBlob2          = RestContext.response.responseBody;


            String jsonResponseString2  =  jsonBlob2.toString();
            
            
            //String requestJSONString2 = '[{"callerSystem":"DIVA","AssessmentNumber":"2812863220ZY09MERCEDES1","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A12 38 2611908","PartNumber":"A12 38 2611908","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"A12 38 261290","PartNumber":"'+pl.PartNumber__c+'","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"'+pl.Alpha_Scale_MRID__c+'"},{"PartLabel":"A12 38 261290","PartNumber":"123457895","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"ASFCS412141521"}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            String requestJSONString2 ='[{"callerSystem":"DIVA","AssessmentNumber":"ASH-228128627632239063220ZY09","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"isShoppingList":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE A12 38 261190","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE A2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"ASCR-XXXXXX","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH2812","PartNumber":"ASH2812","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Labour","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE ASH281286","PartNumber":"ASH281286","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Manual","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"MERCEDES","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"FR2763223906"},"currentClaim":{"ClaimReference":"ASH-2281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            RestRequest request2        = new RestRequest();
            request2.httpMethod         = 'POST';
            request2.requestURI         = '/v2.0/upsertAssessmentOld/*';
            request2.requestBody        = Blob.valueOf(requestJSONString2);

            RestContext.request         = request2;
            RestContext.response        = new RestResponse();
            

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();              
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();
            //system.debug('## jsonResponseString: '+jsonResponseString);

            //System.assertEquals(true, jsonResponseString.contains('not contain substitutes: '));

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                         WHERE  AssessmentNumber__c LIKE 'ASH-2281286NULL3220ZY09%'];
            

            system.debug('##assessmentCreatedList upsertAssessmentUpdate_TEST' +assessmentCreatedList);

            //System.assertEquals(2, assessmentCreatedList.size()); 
            
            list<PartList__c> plList = [Select id, Name, Alpha_Scale_MRID__c, PartNumber__c from PartList__c where isDeleted__c = true and Assessment__c =: assessmentCreatedList[0].Id];
            system.debug('## plList:'+plList);
            //System.assertEquals(4, plList.size()); 
            
        }
    }

    /*@isTest static void upsertAssessmentNewWithSubstitutes_TEST() {
        System.runAs(adminUser){
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE R","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE L ","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessment/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;


            String jsonResponseString   =  jsonBlob.toString();
            
            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                          WHERE AssessmentNumber__c LIKE '28128627632239063220ZY09%'];
 
            //System.assertEquals(2, assessmentCreatedList.size());

        } 
    }*/

    //@isTest static void upsertAssessmentUpdateWithSubstitutes_TEST(){
    //  System.runAs(adminUser){
    //      String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE R","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE L ","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

    //      RestRequest request         = new RestRequest();
    //      request.httpMethod          = 'POST';
    //      request.requestURI          = '/v2.0/upsertAssessment/*';
    //      request.requestBody         = Blob.valueOf(requestJSONString);

    //      RestContext.request         = request;
    //      RestContext.response        = new RestResponse();

    //      RESTUpsertAssessmentV1.upsertAssessment(); 
    //      Blob jsonBlob2              = RestContext.response.responseBody;
    //      String jsonResponseString2  =  jsonBlob2.toString();
            
    //      String requestJSONStringUpd ='[{"callerSystem":"DIVA","AssessmentNumber":"28128627632239063220ZY09","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE L  - '+ cr.IAMManufacturer__c + ' (' + cr.IAMPartNumber__c + ')","PartNumber":"'+cr.IAMPartNumber__c+'","Price":77.9765,"Quantity":1,"RecordType":"Material","AlphaScaleMRID":"'+cr.Name+'","Compliance":true,"InputType":"Automatic","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE R - '+ cr.IAMManufacturer__c + ' (' + cr.IAMPartNumber__c + ')","PartNumber":"'+cr.IAMPartNumber__c+'","Price":77.9765,"Quantity":1,"RecordType":"Material","AlphaScaleMRID":"'+cr.Name+'","Compliance":true,"InputType":"Automatic","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
    //      RestRequest request2        = new RestRequest();
    //      request2.httpMethod         = 'POST';
    //      request2.requestURI         = '/v2.0/upsertAssessment/*';
    //      request2.requestBody        = Blob.valueOf(requestJSONStringUpd);

    //      RestContext.request         = request2;
    //      RestContext.response        = new RestResponse();
            

    //      Test.startTest();
    //          RESTUpsertAssessmentV1.upsertAssessment();              
    //      Test.stopTest();

    //      Blob jsonBlob               = RestContext.response.responseBody;

    //      System.assertNotEquals(null, jsonBlob);

    //      String jsonResponseString   =  jsonBlob.toString();
            
    //      List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
    //                                                          EntityCode__c, Manufacturer__c, VINCheck__c
    //                                                   FROM   Assessment__c
    //                                                   WHERE  AssessmentNumber__c LIKE '28128627632239063220ZY09%'];
            

    //      system.debug('##assessmentCreatedList upsertAssessmentUpdate_TEST' +assessmentCreatedList);

    //      System.assertEquals(2, assessmentCreatedList.size()); 
    
    //  }
    //}

    /*@isTest static void upsertAssessmentUpdateWithSubstitutes2_TEST(){
        System.runAs(adminUser){
            String requestJSONString    = '[{"callerSystem":"DIVA","AssessmentNumber":"","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE R","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE L ","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';

            RestRequest request         = new RestRequest();
            request.httpMethod          = 'POST';
            request.requestURI          = '/v2.0/upsertAssessment/*';
            request.requestBody         = Blob.valueOf(requestJSONString);

            RestContext.request         = request;
            RestContext.response        = new RestResponse();

            RESTUpsertAssessmentV1.upsertAssessment(); 
            Blob jsonBlob2              = RestContext.response.responseBody;
            String jsonResponseString2  =  jsonBlob2.toString();
                    
            String requestJSONStringUpd ='[{"callerSystem":"DIVA","AssessmentNumber":"28128627632239063220ZY09","BSInternalRef":"ext1","crashCode":"1","Entity":"AXA Direct","EntityCode":"299","ExpertValidationDate":"2015-04-13T14:10:33.278Z","MissionNumber":"0000012","Name":"AI360505","IsSubstitution":true,"VINCheck":0,"Parts":[{"PartLabel":"FRONT LWR AIR GRILLE L  - ' + cr.IAMManufacturer__c + ' (' + cr.IAMPartNumber__c + ')","PartNumber":"' + cr.IAMPartNumber__c + '","Price":77.9765,"Quantity":1,"RecordType":"Material","AlphaScaleMRID":"' + cr.Name + '","Compliance":true,"InputType":"Automatic","IsSelected":false},{"PartLabel":"FRONT LWR AIR GRILLE R","PartNumber":"A12 38 261190","Price":58,"Manufacturer":"BOSH","Quantity":10,"InterventionCode":"A01","NBHoursLabourPartLevel1":50,"NBHoursLabourPartLevel2":50,"NBHoursLabourPartLevel3":50,"NBHoursLabourPainting":50,"Discount":50,"VATRate":20,"ARCAUTOCode":"AB01","RecordType":"Material","Compliance":true,"InputType":"Automatic","Currency":"EUR","CertifyingOrganization":"CR","AlphaScaleMRID":"","IsSelected":false}],"currentAsset":{"Brand":"M1","Model":"PRIUS T4","PlateNumber":"3220 ZY 09","FirstRegistrationDate":"2015-04-13","VINNumber":"JTDKN36U601451563","KMS":32000,"PaintingType":"V","Colour":"Green","Energy":"Energy","PickupDate":"2015-04-13T14:10:33.278Z","VDSCode":"02"},"currentBodyShop":{"ReferenceNumber":"2763223906"},"currentClaim":{"ClaimReference":"281286","CompanyName":"CPY","DateOfIncident":"2015-04-13","RepairsAuthorised":true,"Fraud":true,"TotalLoss":true,"Fleet":true,"Rental":true,"SpecialAgreement":true,"ExcessAmount":234.23,"QuotationAmountExlVAT":500,"QuotationAmountInclVAT":500,"TotalAmtLabourPainting":200,"TotalAmtLabour":200,"TotalAmtParts":200,"TotalAmtPainting":200,"TotalAmtExlVAT":200,"TotalVAT":200,"TotalAmtInclVAT":200,"NBHoursLabour":200,"NBHoursLabourLevel1":200,"NBHoursLabourLevel2":200,"NBHoursLabourLevel3":200,"TotalAmtLabourExlPainting":200,"NBHoursLabourPainting":200,"TotalAmtPaintingInclLabour":200,"AmtOthers":200}}]';
            
            RestRequest request2        = new RestRequest();
            request2.httpMethod         = 'POST';
            request2.requestURI         = '/v2.0/upsertAssessment/*';
            request2.requestBody        = Blob.valueOf(requestJSONStringUpd);

            RestContext.request         = request2;
            RestContext.response        = new RestResponse();
            

            Test.startTest();
                RESTUpsertAssessmentV1.upsertAssessment();              
            Test.stopTest();

            Blob jsonBlob               = RestContext.response.responseBody;

            //System.assertNotEquals(null, jsonBlob);

            String jsonResponseString   =  jsonBlob.toString();     

            List<Assessment__c> assessmentCreatedList = [SELECT Id, Name, Status__c, AssessmentNumber__c, BodyShop__c,
                                                                EntityCode__c, Manufacturer__c, VINCheck__c
                                                         FROM   Assessment__c
                                                         WHERE  AssessmentNumber__c LIKE '28128627632239063220ZY09%'];
            

            //System.assertEquals(2, assessmentCreatedList.size()); 
    
        }
    }*/

}